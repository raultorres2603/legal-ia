meta {
  name: 11 - Get Updated User Profile with Financial Data
  type: http
  seq: 11
}

get {
  url: {{baseUrl}}/users/{{userId}}
  body: none
  auth: bearer
}

auth:bearer {
  token: {{jwtToken}}
}

tests {
  test("Should get user profile with updated financial data", function() {
    expect(res.getStatus()).to.equal(200);
  });
  
  test("Should have calculated year-to-date totals", function() {
    const responseJson = res.getBody();
    expect(responseJson.totalIncomeCurrentYear).to.be.above(15000);
    expect(responseJson.totalVATCurrentYear).to.be.above(3000);
    expect(responseJson.totalIRPFCurrentYear).to.be.above(2000);
  });
  
  test("Should have current quarter data", function() {
    const responseJson = res.getBody();
    expect(responseJson.totalIncomeCurrentQuarter).to.be.above(6000);
    expect(responseJson.invoiceCountCurrentYear).to.be.above(3);
  });
}

script:post-response {
  if (res.status === 200) {
    const userData = res.body;
    console.log("ðŸ‘¤ User Profile Updated:");
    console.log("ðŸ’° Year Income: â‚¬" + userData.totalIncomeCurrentYear);
    console.log("ðŸ§¾ Year VAT: â‚¬" + userData.totalVATCurrentYear);
    console.log("ðŸ“‹ Year IRPF: â‚¬" + userData.totalIRPFCurrentYear);
    console.log("ðŸ“Š Q3 Income: â‚¬" + userData.totalIncomeCurrentQuarter);
    console.log("ðŸ“„ Total Invoices: " + userData.invoiceCountCurrentYear);
  }
}
