meta {
  name: 10 - Add Item to Q1-2025-001
  type: http
  seq: 10
}

post {
  url: {{baseUrl}}/invoices/{{invoice4Id}}/items
  body: json
  auth: bearer
}

auth:bearer {
  token: {{jwtToken}}
}

body:json {
  {
    "description": "ConsultorÃ­a inicial y plan estratÃ©gico",
    "quantity": 2,
    "unitPrice": 1250.00,
    "vatRate": 21.0,
    "irpfRate": 15.0
  }
}

tests {
  test("Should add Q1 invoice item", function() {
    expect(res.getStatus()).to.equal(201);
  });
  
  test("Should complete year-to-date financial data", function() {
    const responseJson = res.getBody();
    const totalBase = 2 * 1250.00; // â‚¬2,500
    expect(responseJson.vatAmount).to.equal(525.00);
    expect(responseJson.irpfAmount).to.equal(375.00);
  });
}

script:post-response {
  if (res.status === 201) {
    console.log("ðŸ’° Added final item: â‚¬2,500");
    console.log("ðŸ“Š TOTAL YEAR-TO-DATE REVENUE: â‚¬17,900");
    console.log("ðŸ§¾ VAT collected: ~â‚¬3,759");
    console.log("ðŸ“‹ IRPF retained: ~â‚¬2,685");
    console.log("ðŸŽ¯ Ready to test AI personalized guidance!");
  }
}
