meta {
  name: Update Invoice
  type: http
  seq: 6
}

patch {
  url: {{baseUrl}}/invoices/user/{{invoiceId}}
  body: json
  auth: inherit
}

body:json {
  {
      "id": "{{invoiceId}}",
      "clientName": "{{$randomFullName}}",
      "clientNIF": "{{randomDni}}",
      "clientAddress": "{{$randomStreetAddress}}",
      "IRPF": 15,
      "notes": "{{$randomLoremSentence}}"
  }
}

script:pre-request {
  function randomDni() {
    const letters = 'TRWAGMYFPDXBNJZSQVHLCKE'; // checksum map
    const n = Math.floor(Math.random() * 100000000); // 0..99,999,999
    const numStr = n.toString().padStart(8, '0');    // 8 digits
    const letter = letters[n % 23];
    return `${numStr}${letter}`;
  }
  
  bru.setEnvVar("randomDni",randomDni())
}

settings {
  encodeUrl: true
}
