meta {
  name: Create Invoice Item
  type: http
  seq: 7
}

post {
  url: {{baseUrl}}/invoice-items/user
  body: json
  auth: inherit
}

headers {
  Content-Type: application/json
}

body:json {
  {
    "invoiceId": "{{invoiceId}}",
    "description": "LEGAL service",
    "quantity": 1,
    "unitPrice": {{$randomPrice}},
    "VAT": {{randomVat}},
    "IRPF": {{randomIrpf}},
    "total": {{randomTotal}}
  }
}

script:pre-request {
  const vat = bru.interpolate("{{$randomPrice}}")
  const irpf = bru.interpolate("{{$randomPrice}}")
  const total = parseInt(vat) + parseInt(irpf)
  bru.setEnvVar("randomVat",vat)
  bru.setEnvVar("randomIrpf",irpf)
  bru.setEnvVar("randomTotal",total)
}

script:post-response {
  // Set invoiceItemId
  bru.setEnvVar("invoiceItemId", res.getBody().id);
}

settings {
  encodeUrl: true
}
